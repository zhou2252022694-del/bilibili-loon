name: Bilibili 首页净化 (强力修复版)
desc: "针对直播卡片顽固问题，通过拦截 grpc 及增强脚本覆盖实现。"
category: Rewrite

mitm:
  hostnames:
    - app.bilibili.com
    - config.bilibili.com
    - grpc.bilibili.com

rewrites:
  # 拦截首页所有的 feed 增量接口，强制 App 只走 feed/index
  - match: ^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index\/add
    type: reject
  # 拦截 gRPC 相关域名，强制降级到普通 HTTP 环境
  - match: ^https?:\/\/grpc\.bilibili\.com
    type: reject
  # 拦截首页广告（静态拦截）
  - match: ^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index\/ad
    type: reject

scripts:
  # 首页去直播 (增加对 index/index 的匹配，扩大范围)
  - name: Bili_Home_Clean
    type: http-response
    match: ^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index
    script_url: https://raw.githubusercontent.com/app2smile/rules/master/js/bilibili-v2.js
    requires_body: true
    timeout: 10

  # 空降助手
  - name: Bili_AirDrop
    type: http-response
    match: ^https:\/\/app\.bilibili\.com\/x\/v2\/view\?
    script_url: https://raw.githubusercontent.com/app2smile/rules/master/js/bilibili-v2.js
    requires_body: true
